import random
import logging
import os
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# ========== –¢–í–û–ò –î–ê–ù–ù–´–ï (–º–µ–Ω—è–µ–º –Ω–∞ —Å–≤–æ–∏) ==========
YOUR_USER_ID = 8449323467  # –£–∑–Ω–∞–π —É @userinfobot
BOT_TOKEN = "8580195855:AAHpKyKKS_ResHZRyuBRE6Oe9yD-SVsRQSQ"  # –¢–≤–æ–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
# =================================================

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)

# ========== –ë–ê–ó–ê –§–†–ê–ó –°–ï–ö–†–ï–¢–ê–†–Ø ==========
PHRASES = {
    'greeting': [
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∞—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—á–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –ì–∞–π—Ä–∞—Ç–∂–æ–Ω–∞ ü§µ",
        "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –Ø –ø–æ–º–æ—â–Ω–∏–∫ –ì–∞–π—Ä–∞—Ç–∂–æ–Ω–∞. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
        "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –ì–∞–π—Ä–∞—Ç–∂–æ–Ω —Å–∫–æ—Ä–æ –æ—Ç–≤–µ—Ç–∏—Ç, –∞ –ø–æ–∫–∞ —è –∫ –≤–∞—à–∏–º —É—Å–ª—É–≥–∞–º!",
        "–ê–ª–ª–æ! –≠—Ç–æ —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –ì–∞–π—Ä–∞—Ç–∂–æ–Ω–∞. –•–æ–∑—è–∏–Ω –∑–∞–Ω—è—Ç, –Ω–æ —è —Ç—É—Ç –∫–∞–∫ —Ç—É—Ç!",
    ],
    'joke_offer': [
        "–ú–æ–∂–µ—Ç –∞–Ω–µ–∫–¥–æ—Ç –ø–æ–∂–µ–ª–∞–µ—Ç–µ? –£ –º–µ–Ω—è –∏—Ö —Ü–µ–ª–∞—è –±–∞–∑–∞! üòÑ",
        "–•–æ—Ç–∏—Ç–µ —à—É—Ç–∫—É? –ì–∞–π—Ä–∞—Ç–∂–æ–Ω —Ä–∞–∑—Ä–µ—à–∏–ª –º–Ω–µ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç—å –≥–æ—Å—Ç–µ–π!",
        "–ü–æ–∫–∞ –∂–¥–µ—Ç–µ, –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∞–Ω–µ–∫–¥–æ—Ç. –ù—É –∫–∞–∫, —Å–æ–≥–ª–∞—Å–Ω—ã?",
        "–°–∫—É—á–Ω–æ? –î–µ—Ä–∂–∏—Ç–µ –∞–Ω–µ–∫–¥–æ—Ç, —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ! üé≠",
    ],
    'anecdotes': [
        "–ì–∞–π—Ä–∞—Ç–∂–æ–Ω –≤—á–µ—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–ª –¥–æ —É—Ç—Ä–∞. –£—Ç—Ä–æ–º –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è, –∞ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ß—É–¥–æ!",
        "–ó–≤–æ–Ω–æ–∫ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É:\n- –£ –º–µ–Ω—è –≤–∏—Ä—É—Å –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ!\n- –ê –≤—ã –ø—Ä–æ–±–æ–≤–∞–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å?\n- –í—ã–∫–ª—é—á–∏–ª. –¢–µ–ø–µ—Ä—å –æ–Ω —Å–ø–∏—Ç, –∞ –≤–∏—Ä—É—Å —Ö–æ–¥–∏—Ç –ø–æ –∫–æ–º–Ω–∞—Ç–µ!",
        "–í—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞:\n- –¢—ã —Å–≤–æ—é –∂–µ–Ω—É –ª—é–±–∏—à—å?\n- –ê –∫–∞–∫ –∂–µ! –û–Ω–∞ —É –º–µ–Ω—è —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º!",
        "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ –∏–≥—Ä–∞—é—Ç –≤ —Ñ—É—Ç–±–æ–ª? –ü–æ—Ç–æ–º—É —á—Ç–æ –±–æ—è—Ç—Å—è, —á—Ç–æ –º—è—á –æ–∫–∞–∂–µ—Ç—Å—è —Å –±–∞–≥–∞–º–∏!",
        "–ì–∞–π—Ä–∞—Ç–∂–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç: '–Ø –Ω–µ –≤–æ–ª—à–µ–±–Ω–∏–∫, —è —Ç–æ–ª—å–∫–æ —É—á—É—Å—å'. –ù–æ –∫–æ–¥ –ø–∏—à–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–∞–≥!",
        "–ö–∞–∫ —Ä–∞—Å—Å–º–µ—à–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞? –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –µ–º—É —à—É—Ç–∫—É –ø—Ä–æ 01.01.1970",
    ],
    'facts': [
        "–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ –ì–∞–π—Ä–∞—Ç–∂–æ–Ω –æ–¥–Ω–∞–∂–¥—ã –Ω–∞–ø–∏—Å–∞–ª –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–ª —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞?",
        "–§–∞–∫—Ç: –ì–∞–π—Ä–∞—Ç–∂–æ–Ω –ø—å–µ—Ç –∫–æ—Ñ–µ –ª–∏—Ç—Ä–∞–º–∏, –Ω–æ –∫–æ–¥ –ø–∏—à–µ—Ç –∫–∞–∫ —Ç—Ä–µ–∑–≤—ã–π!",
        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ: –∫–æ–≥–¥–∞ –ì–∞–π—Ä–∞—Ç–∂–æ–Ω —Å–ø–∏—Ç, –µ–≥–æ –∫–æ—Ç –ø–∏—à–µ—Ç –∫–æ–¥ –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ.",
    ],
    'goodbye': [
        "–ì–∞–π—Ä–∞—Ç–∂–æ–Ω—É –±—É–¥–µ—Ç –ø—Ä–∏—è—Ç–Ω–æ! –î–æ —Å–≤–∏–¥–∞–Ω–∏—è! üëã",
        "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–º! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!",
        "–ó–∞—Ö–æ–¥–∏—Ç–µ –µ—â–µ, –ì–∞–π—Ä–∞—Ç–∂–æ–Ω –≤—Å–µ–≥–¥–∞ —Ä–∞–¥ –≥–æ—Å—Ç—è–º!",
        "–ü–æ–∫–∞! –ï—Å–ª–∏ —á—Ç–æ, —è –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ ü§ñ",
    ],
    'default': [
        "–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É, —è –≤—Å—ë –∑–∞–ø–∏—à—É –∏ –ø–µ—Ä–µ–¥–∞–º –ì–∞–π—Ä–∞—Ç–∂–æ–Ω—É! üìù",
        "–ì–∞–π—Ä–∞—Ç–∂–æ–Ω –ø—Ä–æ—Å–∏–ª —É—Ç–æ—á–Ω–∏—Ç—å: —ç—Ç–æ —Å—Ä–æ—á–Ω–æ –∏–ª–∏ —Ç–µ—Ä–ø–∏—Ç?",
        "–ó–∞–ø–∏—Å–∞–ª! –ì–∞–π—Ä–∞—Ç–∂–æ–Ω —Ä–∞–∑–±–µ—Ä–µ—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –¥–æ–ø—å–µ—Ç –∫–æ—Ñ–µ ‚òï",
        "–Ø –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–º –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ê –ø–æ–∫–∞ –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∞–Ω–µ–∫–¥–æ—Ç, —è –ø–æ—Å–ª—É—à–∞—é!",
    ]
}

# –•—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é
user_sessions = {}

def get_response(user_id, text):
    """–í—ã–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç"""
    text_lower = text.lower()
    
    # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    if user_id not in user_sessions:
        user_sessions[user_id] = {'messages': []}
        return f"{random.choice(PHRASES['greeting'])} {random.choice(PHRASES['joke_offer'])}"
    
    user_sessions[user_id]['messages'].append(text)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    if any(word in text_lower for word in ['–∞–Ω–µ–∫–¥–æ—Ç', '—à—É—Ç–∫–∞', '—Å–º–µ—à–Ω–æ', 'üòÇ', 'üòÑ', '—Ö–∞—Ö–∞']):
        return f"–î–µ—Ä–∂–∏—Ç–µ! üé≠\n\n{random.choice(PHRASES['anecdotes'])}"
    
    elif any(word in text_lower for word in ['—Ñ–∞–∫—Ç', '–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ']):
        return f"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç: {random.choice(PHRASES['facts'])}"
    
    elif any(word in text_lower for word in ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '–ø—Ä–æ—â–∞–π', 'bye']):
        return random.choice(PHRASES['goodbye'])
    
    elif any(word in text_lower for word in ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é']):
        return "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –ì–∞–π—Ä–∞—Ç–∂–æ–Ω –±—É–¥–µ—Ç —Ä–∞–¥ –ø–æ–º–æ—á—å –ª–∏—á–Ω–æ! ü§ù"
    
    elif '–≥–∞–π—Ä–∞—Ç–∂–æ–Ω' in text_lower or '—Ö–æ–∑—è–∏–Ω' in text_lower:
        return "–ì–∞–π—Ä–∞—Ç–∂–æ–Ω —Å–µ–π—á–∞—Å –∑–∞–Ω—è—Ç –≤–µ–ª–∏–∫–∏–º–∏ –¥–µ–ª–∞–º–∏ (–∫–æ–¥–∏—Ç –∏–ª–∏ —Å–ø–∏—Ç). –Ø –ø–µ—Ä–µ–¥–∞–º, —á—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–ª–∏!"
    
    # –û—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return random.choice(PHRASES['default'])

# ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ==========
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user = update.effective_user
    response = get_response(user.id, "/start")
    await update.message.reply_text(response)

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user = update.effective_user
    chat_id = update.effective_chat.id
    text = update.message.text
    
    # –ï—Å–ª–∏ –ø–∏—à–µ—Ç —Ö–æ–∑—è–∏–Ω
    if user.id == YOUR_USER_ID:
        await update.message.reply_text("‚úÖ –°–ª—É—à–∞—é—Å—å, —Ö–æ–∑—è–∏–Ω! –Ø –∑–∞–º–æ–ª–∫–∞—é.")
        return
    
    # –û—Ç–≤–µ—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    response = get_response(user.id, text)
    await update.message.reply_text(response)
    
    # –£–≤–µ–¥–æ–º–ª—è–µ–º —Ö–æ–∑—è–∏–Ω–∞
    try:
        await context.bot.send_message(
            chat_id=YOUR_USER_ID,
            text=f"üì© {user.first_name} (@{user.username}):\n{text[:100]}"
        )
    except:
        pass

async def stats(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞"""
    if update.effective_user.id == YOUR_USER_ID:
        await update.message.reply_text(
            f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n"
            f"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(user_sessions)}\n"
            f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–π: {sum(len(s['messages']) for s in user_sessions.values())}"
        )

async def clear(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏"""
    if update.effective_user.id == YOUR_USER_ID:
        user_sessions.clear()
        await update.message.reply_text("üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!")

if __name__ == "__main__":
    print("ü§µ –°–µ–∫—Ä–µ—Ç–∞—Ä—å –ì–∞–π—Ä–∞—Ç–∂–æ–Ω–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    app = Application.builder().token(BOT_TOKEN).build()
    
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("stats", stats))
    app.add_handler(CommandHandler("clear", clear))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    print("‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç! –ò–¥–∏ –≤ Telegram –ø—Ä–æ–≤–µ—Ä—è–π!")
    app.run_polling()
